:80 {
  redir https://{host}{uri} permanent
}

:443 {
  tls /certs/server.crt /certs/server.key
  route {
    reverse_proxy https://backend:3000 {
      transport http {
        tls_insecure_skip_verify
        keepalive 60s
        keepalive_interval 20s
        keepalive_idle_conns 256
        keepalive_idle_conns_per_host 128
        max_conns_per_host 0
        dial_timeout 2s
        response_header_timeout 0
        read_timeout 0
        write_timeout 0
      }
      lb_policy least_conn
    }
  }
}