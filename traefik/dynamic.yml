http:
  routers:
    backend-router:
      rule: "PathPrefix(`/`)"
      service: backend-service
      entryPoints:
        - websecure
      middlewares:
        - compression

  services:
    backend-service:
      loadBalancer:
        servers:
          - url: "https://backend:3000"
        # Keepalive settings similar to nginx
        passHostHeader: true
        responseForwarding:
          flushInterval: 0ms
        healthCheck:
          interval: 30s
          timeout: 5s
          path: /
        serversTransport: default
          
  middlewares:
    compression:
      compress:
        excludedContentTypes:
          - "text/event-stream"

  # Configure transport settings for better performance
  serversTransports:
    default:
      insecureSkipVerify: true
      maxIdleConnsPerHost: 128
      forwardingTimeouts:
        dialTimeout: 2s
        responseHeaderTimeout: 0s
        idleConnTimeout: 65s
  tls:
    certificates:
      - certFile: /certs/server.crt
        keyFile: /certs/server.key
